% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/funs.R
\name{ecoXCorr}
\alias{ecoXCorr}
\title{Run a complete ecoXCorr analysis: aggregation + lagged modelling}
\usage{
ecoXCorr(
  meteo_data,
  response_data,
  date_col_meteo = "date",
  date_col_resp = "date",
  value_cols,
  agg_fun = "mean",
  response,
  lag_unit = 1,
  max_lag,
  random = "",
  family = "gaussian",
  na.rm = TRUE,
  track = FALSE,
  ...
)
}
\arguments{
\item{meteo_data}{Data frame containing meteorological time series.}

\item{response_data}{Data frame containing the response variable and
sampling dates.}

\item{date_col_meteo}{Name of the date column in \code{meteo_data}.}

\item{date_col_resp}{Name of the date column in \code{response_data}.}

\item{value_cols}{Name of one meteorological variables to aggregate.}

\item{agg_fun}{Name (character string) of the aggregation function. Function must accept a numeric vector as first argument. Default to \code{"mean"}.}

\item{response}{Name of the response variable.}

\item{lag_unit}{Length of the base lag interval (in days).}

\item{max_lag}{Maximum number of lag intervals.}

\item{random}{Optional random-effects structure (passed to
\code{fit_models_by_lag}).}

\item{family}{Model family (GLM or glmmTMB).}

\item{na.rm}{Logical indicating whether NA values are removed before aggregation.}

\item{track}{Logical; if TRUE, prints lag windows during model fitting.}

\item{...}{Additional arguments passed to the model fitting function.}
}
\value{
A data frame with one row per lag window, containing:
  \describe{
    \item{lag_start}{Start lag index of the aggregation window.}
    \item{lag_end}{End lag index of the aggregation window.}
    \item{response}{Name of the response variable.}
    \item{predictor}{Name of the predictor variable.}
    \item{R2...}{Coefficient of determination (marginal \eqn{R^2} for mixed models).}
    \item{betas}{Estimated beta parameter of the linear predictor.}
    \item{sign}{Sign of the estimated predictor effect (-1 or +1).}
    \item{d_aic}{AIC reduction compared to the null model.}
    \item{n}{Number of observations used to fit the model.}
    \item{p_value}{P-value associated with the predictor effect.}
    \item{weight}{Akaike weight.}
    \item{p_adj}{P-value adjusted for multiple testing.}
  }
}
\description{
This wrapper function combines \code{\link{aggregate_lagged_intervals}}
and \code{\link{fit_models_by_lag}} into a single workflow. It aggregates
environmental predictors over multiple lag windows relative to sampling
dates, merges them with a response dataset, and fits regression models
separately for each lag window.
}
\details{
Both fixed-effect and mixed-effect models are supported.

The modelling function used depends on the \code{random} and \code{family} arguments:
\itemize{
  \item \code{random} is not specified (default):  \code{\link[stats]{glm}}
  \item \code{random} is note an empty string OR \code{family} is a valid glmmTMB family: \code{\link[glmmTMB]{glmmTMB}}
}

For mixed-effects models, marginal \eqn{R^2} (Nakagawa) is returned. For fixed-effects
models, appropriate \eqn{R^2} is used (see \code{?performance::r2()}).
Depending on model specification (depending on \code{random} and/or \code{family}), \eqn{R^2} for \code{\link[glmmTMB]{glmmTMB}} models may not be computed: the returned error or warning is printed in the console.


For each unique combination of \code{lag_start} and \code{lag_end}, the
function:
\enumerate{
  \item Subsets the data to the corresponding lag window,
  \item Removes rows with missing values in the response or predictor,
  \item Fits the specified model,
  \item Extracts beta parameter of the linear predictor,
  \item Extracts the p-value of the predictor effect,
  \item Computes AIC for the specified and null models,
  \item Computes the appropriate model\eqn{R^2} (marginal Nakagawa \eqn{R^2} for mixed models),
  \item Records the sign of the estimated effect and the sample size,
  \item Computes delta-AIC and Akaike weight of each model \insertCite{vandepolIdentifyingBestClimatic2016}{ecoXCorr},
  \item Computes adjusted p-value using the False Discovery Rate method \insertCite{benjaminiControlFalseDiscovery2001}{ecoXCorr}
}

The returned table is suitable for lag-window screening, heatmap
visualisation, or sensitivity analyses in epidemiological or ecological
studies.
}
\examples{
res_glmm <- ecoXCorr(
meteo_data    = meteoMPL2023,
response_data = albopictusMPL2023,
date_col_meteo   = "date",
date_col_resp    = "date",
value_cols    = "rain_sum",
agg_fun       = "sum",
response      = "individualCount",
lag_unit      = 7,
max_lag       = 8,
random        = "(1|area/trap)",
family        = "nbinom2"
)

head(res_glmm)

}
\references{
\insertAllCited{}
}
