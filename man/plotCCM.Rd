% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/funs.R
\name{plotCCM}
\alias{plotCCM}
\title{Plot a cross-correlation map (CCM) from lagged regression results}
\usage{
plotCCM(
  data,
  model_outcome = c("d_aic", "R2sign", "R2", "betas", "weight"),
  threshold_p = 1
)
}
\arguments{
\item{data}{A data.frame produced by \code{\link{fit_models_by_lag}}, containing
at least the columns \code{lag_start}, \code{lag_end}, \code{r2},
\code{p_value}, and \code{sign}.}

\item{model_outcome}{Character string specifying the model's outcomes to plot. Either:
\itemize{
  \item \code{"d_aic"} for the delta AIC (compared to the null model) (default),
  \item \code{"R2sign"} for the signed coefficient of determination,
  computed as the marginal or classical \eqn{R^2} multiplied by the sign of the estimated effect,
  \item \code{"R2"} for the coefficient of determination (\eqn{R^2}) or,
  \item \code{"betas"} for the estimated beta parameter (slope) of the linear predictor.
  }}

\item{threshold_p}{Numeric value giving the p-value threshold above which
associations are masked (set to \code{NA}) in the plot. Filtering is performed on
the adjusted (for multiple testing) p-values \code{p_adj}. (Default is \code{1},
meaning that no filtering is applied.}
}
\value{
A \code{ggplot2} object representing the cross-correlation map.
}
\description{
This function visualises the strength and direction of associations between
a response variable and a lagged predictor across multiple lag windows, using
the output of \code{\link{fit_models_by_lag}}. The resulting plot is a
two-dimensional "cross-correlation map", where each tile represents a
lag window defined by \code{lag_start} and \code{lag_end}.
}
\details{
The colour of each tile corresponds to \code{model_outcome}. Positive associations are shown in red, negative
associations in blue, and non-significant or filtered values (using \code{threshold_p}) are shown in grey.

The lag window yielding the maximum absolute value of \code{model_outcome} is highlighted
with a coloured border.


The x-axis corresponds to \code{lag_start} (displayed in reverse order), and
the y-axis corresponds to \code{lag_end}. Tiles are coloured using a diverging
colour scale centred on zero. Lag windows with \code{p_value >= threshold_p}
are not displayed and appear in grey.

This function does not perform any modelling itself; it is intended solely
for visualising results obtained from \code{\link{fit_models_by_lag}}.
}
\examples{
sampling_dates <- unique(albopictusMPL2023$date)

met_agg <- aggregate_lagged_intervals(
data       = meteoMPL2023,
date_col   = "date",
value_cols = c("rain_sum", "temp_mean"),
d          = sampling_dates,
i          = 7,
m          = 8
)

albo_lag <- merge(met_agg, albopictusMPL2023, by = "date", all = TRUE)

res_glm <- fit_models_by_lag(
data       = albo_lag,
response   = "individualCount",
predictors = "rain_sum_sum",
random     = "",
family     = "poisson"
)

plotCCM(res_glm, model_outcome = "R2sign", threshold_p = 0.05)
plotCCM(res_glm, model_outcome = "R2")
plotCCM(res_glm, model_outcome = "d_aic")
plotCCM(res_glm, model_outcome = "betas", threshold_p = 0.05)

}
\seealso{
\code{\link{fit_models_by_lag}}, \code{\link[ggplot2]{ggplot}}
}
