% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/funs.R
\name{aggregate_lagged_intervals}
\alias{aggregate_lagged_intervals}
\title{Aggregate meteorological time series over multiple lagged time intervals}
\usage{
aggregate_lagged_intervals(
  data,
  date_col,
  value_cols,
  d,
  i = 1,
  m,
  x = 0,
  funs = list(mean = mean, min = min, max = max, sum = sum),
  na.rm = TRUE
)
}
\arguments{
\item{data}{A data.frame containing the meteorological time series.}

\item{date_col}{Character string giving the name of the date column in
\code{data}. The column must be of class \code{Date} or \code{POSIXct}.}

\item{value_cols}{Character vector giving the names of numeric variables
to be aggregated (e.g. rainfall, temperature).}

\item{d}{Vector of reference *dates*. Can be of class \code{Date} or coercible
to \code{Date}. Aggregations are computed independently for each date.}

\item{i}{Integer giving the length of the base time *interval*, expressed in days.
Each elementary lag block contains exactly \code{i} calendar days.
(e.g. \code{1} for daily data, \code{7} for weekly intervals,
\code{14} for fortnightly intervals).}

\item{m}{Integer giving the *maximum* lag (number of intervals) to consider.
All combinations of lag windows with \code{1 <= lag_end <= lag_start <= m}
are evaluated.}

\item{x}{Integer specifying how many most recent days (in reverse
  chronological order) to exclude before the reference date \code{d} when
  constructing lag windows.

  When \code{x = 0}, lag intervals end exactly at and include the reference date
  \code{d}.
  When \code{x = 1}, the reference date itself is excluded and lag
  intervals end at \code{d - 1}.
  More generally, lag windows end at \code{d - x}, so increasing
  \code{x} shifts all lag intervals further back in time and excludes the
  \code{x} most recent time units from the aggregation.

  This parameter is useful when the predictor measured at or immediately
  before the sampling date should not contribute to the lagged summary.}

\item{funs}{Named list of aggregation functions to apply to each variable.
Each function must accept a numeric vector as first argument. The names
of the list are used to construct output column names
(e.g. \code{rain_mean}, \code{temp_max}). Defaults to mean, min, max and sum.}

\item{na.rm}{Logical indicating whether missing values should be removed
before aggregation. Passed to the aggregation functions (default: \code{TRUE}).}
}
\value{
A data.frame with one row per reference date and lag window, containing:
  \itemize{
    \item \code{date}: reference date
    \item \code{start}, \code{end}: start (inclusive) and end (exclusive) of
      the aggregation interval
    \item \code{lag_start}, \code{lag_end}: lag indices defining the interval
    \item One column per combination of variable and aggregation function
      (e.g. \code{rain_mean}, \code{temperature_sum})
  }
}
\description{
This function computes aggregated values of one or several meteorological
time series over all possible lagged time intervals defined relative to one
or more reference dates. For each reference date \code{d}, lag windows are
constructed backward in time as
\eqn{[d - x - k \times i + 1,\; d - x - (l - 1) \times i]},
where \code{i} is the base interval length (in days), \code{m} is the maximum
number of intervals considered, and \code{k, l} range from 1 to \code{m} with
\code{k >= l}. The parameter \code{x} controls how many of the most recent
days (including \code{d} when \code{x >= 1}) are excluded before
constructing the lag windows.
}
\details{
The function supports multiple reference dates, multiple variables, and
multiple aggregation functions, and returns all combinations as additional
columns in the output data frame.

Reference dates for which at least one interval contains no observations are
reported in the console as having missing data. Reference dates for which at
least one interval partially lies outside the temporal bounds of the input
time series are reported as having truncated intervals.


Console messages are printed to inform the user of reference dates for which
missing data or truncated intervals occurred.

An interval is considered truncated if it extends
beyond the temporal bounds of the input time series. An interval is considered
missing if no observations fall within it.
}
\examples{
sampling_dates <- unique(albopictusMPL2023$date)

met_agg <- aggregate_lagged_intervals(
data       = meteoMPL2023,
date_col   = "date",
value_cols = c("rain_sum", "temp_mean"),
d          = sampling_dates,
i          = 7,
m          = 8
)

head(met_agg)

}
